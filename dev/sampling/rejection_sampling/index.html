<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Rejection sampling · Random notes</title><meta name="title" content="Rejection sampling · Random notes"/><meta property="og:title" content="Rejection sampling · Random notes"/><meta property="twitter:title" content="Rejection sampling · Random notes"/><meta name="description" content="Documentation for Random notes."/><meta property="og:description" content="Documentation for Random notes."/><meta property="twitter:description" content="Documentation for Random notes."/><meta property="og:url" content="https://github.com/rmsrosa/random_notes/sampling/rejection_sampling/"/><meta property="twitter:url" content="https://github.com/rmsrosa/random_notes/sampling/rejection_sampling/"/><link rel="canonical" href="https://github.com/rmsrosa/random_notes/sampling/rejection_sampling/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/style.css" rel="stylesheet" type="text/css"/><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="Random notes logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Random notes</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Random Notes</a></li><li><span class="tocitem">Probability Essentials</span><ul><li><a class="tocitem" href="../../probability/kernel_density_estimation/">Kernel Density Estimation</a></li><li><a class="tocitem" href="../../probability/convergence_notions/">Convergence notions</a></li></ul></li><li><span class="tocitem">Discrete-time Markov chains</span><ul><li><a class="tocitem" href="../../markov_chains/mc_definitions/">Essential definitions</a></li><li><a class="tocitem" href="../../markov_chains/mc_invariance/">Invariant distributions</a></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Countable-space Markov chains</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../markov_chains/mc_countableX_recurrence/">Recurrence in the countable-space case</a></li><li><a class="tocitem" href="../../markov_chains/mc_countableX_connections/">Connected states, irreducibility and uniqueness of invariant measures</a></li><li><a class="tocitem" href="../../markov_chains/mc_countableX_convergencia/">Aperiodicidade e convergência para a distribuição estacionária</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Continuous-space Markov chains</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../markov_chains/mc_irreducibility_and_recurrence/">Irreducibility and recurrence in the continuous-space case</a></li></ul></li></ul></li><li><span class="tocitem">Sampling methods</span><ul><li><a class="tocitem" href="../overview/">Overview</a></li><li><a class="tocitem" href="../prng/">Random number generators</a></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Transform methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../invFtransform/">Probability integral transform</a></li><li><a class="tocitem" href="../box_muller/">Box-Muller transform</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Accept-Reject methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Rejection sampling</a><ul class="internal"><li><a class="tocitem" href="#Setting"><span>Setting</span></a></li><li><a class="tocitem" href="#The-rejection-sampling-method"><span>The rejection sampling method</span></a></li><li><a class="tocitem" href="#Expected-acceptance-rate"><span>Expected acceptance rate</span></a></li><li><a class="tocitem" href="#Distribution-of-the-accepted-samples"><span>Distribution of the accepted samples</span></a></li><li><a class="tocitem" href="#Numerical-example"><span>Numerical example</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../empiricalsup_rejection/">Empirical supremum rejection sampling</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox"/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Markov Chain Monte Carlo (MCMC)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../mcmc/">Overview</a></li><li><a class="tocitem" href="../metropolis/">Metropolis and Metropolis-Hastings</a></li><li><a class="tocitem" href="../convergence_metropolis/">Convergence of Metropolis-Hastings</a></li><li><a class="tocitem" href="../gibbs/">Gibbs sampling</a></li><li><a class="tocitem" href="../hmc/">Hamiltonian Monte Carlo (HMC)</a></li></ul></li><li><a class="tocitem" href="../langevin_sampling/">Langevin sampling</a></li></ul></li><li><span class="tocitem">Bayesian inference</span><ul><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">Bayes Theory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../bayesian/bayes/">Bayes Theorem</a></li><li><a class="tocitem" href="../../bayesian/bayes_inference/">Bayesian inference</a></li><li><a class="tocitem" href="../../bayesian/bernstein_vonmises/">Bernstein–von Mises theorem</a></li></ul></li><li><a class="tocitem" href="../../bayesian/bayesian_probprog/">Bayesian probabilistic programming</a></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../bayesian/find_pi/">Estimating π via frequentist and Bayesian methods</a></li><li><a class="tocitem" href="../../bayesian/linear_regression/">Many Ways to Linear Regression</a></li><li><a class="tocitem" href="../../bayesian/tilapia_alometry/">Alometry law for the Nile Tilapia</a></li><li><a class="tocitem" href="../../bayesian/mortality_tables/">Modeling mortality tables</a></li></ul></li></ul></li><li><span class="tocitem">Generative models</span><ul><li><input class="collapse-toggle" id="menuitem-6-1" type="checkbox"/><label class="tocitem" for="menuitem-6-1"><span class="docs-label">Score matching</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../generative/overview/">Overview</a></li><li><a class="tocitem" href="../../generative/stein_score/">Stein score function</a></li><li><a class="tocitem" href="../../generative/score_matching_aapo/">Score matching of Aapo Hyvärinen</a></li><li><a class="tocitem" href="../../generative/score_matching_neural_network/">Score matching a neural network</a></li><li><a class="tocitem" href="../../generative/parzen_estimation_score_matching/">Score matching with Parzen estimation</a></li><li><a class="tocitem" href="../../generative/denoising_score_matching/">Denoising score matching of Pascal Vincent</a></li><li><a class="tocitem" href="../../generative/sliced_score_matching/">Sliced score matching</a></li><li><a class="tocitem" href="../../generative/1d_FD_score_matching/">1D finite-difference score matching</a></li><li><a class="tocitem" href="../../generative/2d_FD_score_matching/">2D finite-difference score matching</a></li><li><a class="tocitem" href="../../generative/ddpm/">Denoising diffusion probabilistic models</a></li><li><a class="tocitem" href="../../generative/mdsm/">Multiple denoising score matching</a></li><li><a class="tocitem" href="../../generative/probability_flow/">Probability flow</a></li><li><a class="tocitem" href="../../generative/reverse_flow/">Reverse probability flow</a></li><li><a class="tocitem" href="../../generative/score_based_sde/">Score-based SDE model</a></li></ul></li></ul></li><li><span class="tocitem">Sensitivity analysis</span><ul><li><a class="tocitem" href="../../sensitivity/overview/">Overview</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Sampling methods</a></li><li><a class="is-disabled">Accept-Reject methods</a></li><li class="is-active"><a href>Rejection sampling</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Rejection sampling</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/rmsrosa/random_notes" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/rmsrosa/random_notes/blob/main/docs/src/sampling/rejection_sampling.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Rejection-sampling-method"><a class="docs-heading-anchor" href="#Rejection-sampling-method">Rejection sampling method</a><a id="Rejection-sampling-method-1"></a><a class="docs-heading-anchor-permalink" href="#Rejection-sampling-method" title="Permalink"></a></h1><p>The <strong>Rejection Sampling</strong> method, or <strong>Acceptance-rejection method,</strong> was proposed by von Neumann (1951). See, for instance, <a href="https://doi.org/10.1007/978-0-387-76371-2">Liu (2004)</a> and <a href="https://doi.org/10.1201/9781482296426">Gamerman and Lopes (2006)</a>.</p><h2 id="Setting"><a class="docs-heading-anchor" href="#Setting">Setting</a><a id="Setting-1"></a><a class="docs-heading-anchor-permalink" href="#Setting" title="Permalink"></a></h2><p>One considers a univariate random variable <span>$X$</span> with density <span>$p=p(x)$</span> under the following assumptions:</p><ol><li>We may not know the density <span>$p(x)$</span> but we do know a non-negative function <span>$f(x)$</span> proportional to the density, with some unknown normalizing constant <span>$Z &gt; 0,$</span> i.e.<p class="math-container">\[     p(x) = \frac{f(x)}{Z}. \]</p></li><li>We know how to sample from another random variable <span>$X&#39;$</span> with known density <span>$q=q(x)$</span> which bounds a multiple of the function <span>$f(x)$</span> with a known bound, i.e. for some known <span>$M&gt;0,$</span></li></ol><p class="math-container">\[    f(x) \leq M q(x), \quad \forall x.\]</p><h2 id="The-rejection-sampling-method"><a class="docs-heading-anchor" href="#The-rejection-sampling-method">The rejection sampling method</a><a id="The-rejection-sampling-method-1"></a><a class="docs-heading-anchor-permalink" href="#The-rejection-sampling-method" title="Permalink"></a></h2><p>Under this setting, we obtain samples of <span>$X$</span> by sampling from <span>$X&#39;$</span> and accepting or rejecting the candidate sample according to a specific criteria, and we repeat the process until a candidate is accepted, and for as many samples that we want. More precisely, here are the steps of the method.</p><ol><li>Draw a sample <span>$x&#39;$</span> of <span>$X&#39;,$</span> which we call a <em>candidate sample;</em></li><li>Compute the <em>acceptance ratio</em> <span>$r(x&#39;),$</span> where</li></ol><p class="math-container">\[    r(x) = \frac{f(x)}{Mq(x)}.\]</p><ol><li>Draw a sample <span>$u$</span> from the uniform distribution <span>$\operatorname{Uniform}(0, 1).$</span></li><li>Accept/reject step:<ol><li>If <span>$u \leq r(x&#39;),$</span> accept the sample <span>$x&#39;$</span> as a sample <span>$x=x&#39;$</span> of the desired random variable <span>$X;$</span></li><li>otherwise, if <span>$u &gt; r(x&#39;),$</span> reject the sample <span>$x&#39;$</span> and repeat the process drawing a new candidate and so on, until a candidate sample is accepted.</li></ol></li><li>Repeat for as many samples as desired.</li></ol><p>How do you check that this really yields samples of <span>$X?$</span></p><p>Let us start with another, but related, question: How often is a candidate sample accepted?</p><h2 id="Expected-acceptance-rate"><a class="docs-heading-anchor" href="#Expected-acceptance-rate">Expected acceptance rate</a><a id="Expected-acceptance-rate-1"></a><a class="docs-heading-anchor-permalink" href="#Expected-acceptance-rate" title="Permalink"></a></h2><p>First, notice that</p><p class="math-container">\[    \mathbb{P}(X&#39; \textrm{ is accepted}) = \mathbb{P}\left(U \leq \frac{f(X&#39;)}{Mq(X&#39;)}\right) = \int_{\{q(x) &gt; 0\}} \mathbb{P}\left( U \leq \frac{f(x)}{Mq(x)} \bigg| X&#39; = x\right) q(x)\;\mathrm{d}x,\]</p><p>where the integral is restricted to the region <span>$\{q(x) &gt; 0\}$</span> since <span>$q(x)$</span> is the PDF of <span>$X&#39;$</span> and <span>$\{q(x) &gt; 0\}$</span> is a carrier of the random variable <span>$X&#39;,$</span> i.e. <span>$q(X&#39;) &gt; 0$</span> almost surely.</p><p>The probability of <span>$U$</span> being less than <span>$f(x)/Mq(x)$</span> is precisely this ratio, i.e.</p><p class="math-container">\[    \mathbb{P}\left( U \leq \frac{f(x)}{Mq(x)} \bigg| X&#39; = x\right) = \frac{f(x)}{Mq(x)},\]</p><p>again in the region <span>$\{q(x) &gt; 0\}.$</span> Thus,</p><p class="math-container">\[    \begin{align*}
        \mathbb{P}(X&#39; \textrm{ is accepted}) &amp; = \int_{\{q(x) &gt; 0\}} \frac{f(x)}{Mq(x)} q(x)\;\mathrm{d}x = \int_{\{q(x) &gt; 0\}} \frac{f(x)}{M} \;\mathrm{d}x \\
        &amp; = \frac{Z}{M} \int_{\{q(x) &gt; 0\}} \frac{f(x)}{Z} \;\mathrm{d}x = \int_{\{q(x) &gt; 0\}} p(x) \;\mathrm{d}x = \frac{Z}{M}.
    \end{align*}\]</p><p>Recall that <span>$M$</span> is the bound on <span>$f$</span>, so that the ratio <span>$Z/M$</span> is related to the bound on the PDF itself,</p><p class="math-container">\[    p(x) = \frac{f(x)}{Z} \leq \frac{M}{Z}q(x).\]</p><p>Thus, the tighter the bound, the higher the acceptance rate. A poor acceptance rate means we will have to compute a lot of proposed samples and a lot of acceptance checks to obtain a relativaly small portion of actual samples of the desired distribution.</p><h2 id="Distribution-of-the-accepted-samples"><a class="docs-heading-anchor" href="#Distribution-of-the-accepted-samples">Distribution of the accepted samples</a><a id="Distribution-of-the-accepted-samples-1"></a><a class="docs-heading-anchor-permalink" href="#Distribution-of-the-accepted-samples" title="Permalink"></a></h2><p>We may now check the distribution of the accepted samples. This is expressed by the CDF</p><p class="math-container">\[    F_{X&#39; \textrm{ is accepted}} = \mathbb{P}(X&#39; \leq x | X&#39; \textrm{ is accepted}).\]</p><p>This can be computed via</p><p class="math-container">\[    F_{X&#39; \textrm{ is accepted}} = \mathbb{P}(X&#39; \leq x | X&#39; \textrm{ is accepted}) = \frac{\mathbb{P}(X&#39; \leq x, \; X&#39; \textrm{ is accepted})}{\mathbb{P}(X&#39; \textrm{ is accepted})}.\]</p><p>The numerator is given by</p><p class="math-container">\[    \begin{align*}
        \mathbb{P}(X&#39; \leq x, \; X&#39; \textrm{ is accepted}) &amp; = \mathbb{P}\left( X&#39; \leq x, \; U \leq \frac{f(X&#39;)}{Mq(X&#39;)}\right) \\
        &amp; = \int_{\{q(x&#39;) &gt; 0, \; x&#39; \leq x\}} \mathbb{P}\left( U \leq \frac{f(x&#39;)}{Mq(x&#39;)} \right) q(x&#39;) \;\mathrm{d}x&#39; \\
        &amp; = \int_{\{q(x&#39;) &gt; 0, \; x&#39; \leq x\}} \int_{\{0 \leq u \leq f(x&#39;)/Mq(x&#39;)\}} q(x&#39;) \;\mathrm{d}u \;\mathrm{d}x&#39; \\
        &amp; = \int_{\{q(x&#39;) &gt; 0, \; x&#39; \leq x\}} \frac{f(x&#39;)}{Mq(x&#39;)} q(x&#39;)\;\mathrm{d}x&#39; \\
        &amp; = \int_{x&#39;\leq x} \frac{f(x&#39;)}{M} \;\mathrm{d}x&#39; \\
        &amp; = \frac{Z}{M}\int_{x&#39;\leq x} \frac{f(x&#39;)}{Z} \;\mathrm{d}x&#39; \\
        &amp; = \frac{Z}{M} \int_{-\infty}^x p(x&#39;)\;\mathrm{d}x&#39; \\
        &amp; = \frac{Z}{M} F_{X}(x).
    \end{align*}\]</p><p>Thus,</p><p class="math-container">\[    F_{X&#39; \textrm{ is accepted}} = \mathbb{P}(X&#39; \leq x | X&#39; \textrm{ is accepted}) = \frac{\mathbb{P}(X&#39; \leq x, \; X&#39; \textrm{ is accepted})}{\mathbb{P}(X&#39; \textrm{ is accepted})} = \frac{\frac{Z}{M} F_{X}(x)}{\frac{Z}{M}} = F_{X}(x).\]</p><p>In other words, the probability distribution of the accepted samples of <span>$X&#39;$</span> is precisely the distribution of <span>$X.$</span></p><h2 id="Numerical-example"><a class="docs-heading-anchor" href="#Numerical-example">Numerical example</a><a id="Numerical-example-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-example" title="Permalink"></a></h2><p>Let us draw samples from a synthetic distribution with density proportional to a function which is a polynomial with an exponential envelope, of the form</p><p class="math-container">\[    f(x) = (3x^3 + 2x^2 - 4x)^2e^{-x^2}.\]</p><img src="62ed4df9.svg" alt="Example block output"/><p>One can actually compute the normalizing constant we can write</p><p class="math-container">\[    f(x) = (9x^6 + 12x^5 - 20x^4 - 16x^3 + 16x^2) e^{-x^2},\]</p><p>so that the integral with the odd powers vanish and we are left with</p><p class="math-container">\[    \int_{-\infty}^\infty f(x) \;\mathrm{d}x = 9 \int_{-\infty}^\infty x^6 e^{-x^2}\;\mathrm{d}x - 20 \int_{-\infty}^\infty x^4 e^{-x^2}\;\mathrm{d}x + 16 \int_{-\infty}^\infty x^2 e^{-x^2}\;\mathrm{d}x,\]</p><p>and each integral can be seen as multiples of the moments of a normal distribution with zero mean and variance <span>$1/2.$</span> Thus,</p><p class="math-container">\[    \int_{-\infty}^\infty f(x) \;\mathrm{d}x = \sqrt{2\pi\sigma^2} \left( 9 \mathbb{E}[Y^6] - 20\mathbb{E}[Y^4] + 16\mathbb{E}[Y^2]\right),\]</p><p>where <span>$Y \sim \mathcal{N}(0, \sigma^2),$</span> <span>$\sigma^2 = 1/2.$</span> Since</p><p class="math-container">\[    \mathbb{E}[Y^{2n}] = \sigma^n 2^{-n}(2n)!/n!,\]</p><p>we have, in particular,</p><p class="math-container">\[    \mathbb{E}[Y^6] = 15 \sigma^6 = \frac{15}{8}, \quad \mathbb{E}[Y^6] = 15 \sigma^6 = \frac{3}{4}, \quad \mathbb{E}[Y^2] = 15 \sigma^6 = \frac{1}{2}.\]</p><p>Thus,</p><p class="math-container">\[    Z = \int_{-\infty}^\infty f(x) \;\mathrm{d}x = \sqrt{\pi} \left( 9 \frac{15}{8} - 20\frac{3}{4} + 16\frac{1}{2}\right) = \frac{79}{8}\sqrt{\pi} \approx 17.50,\]</p><p>This is the factor <span>$Z$</span> in the expression for the density <span>$f=f(x),$</span></p><p class="math-container">\[    p(x) = \frac{f(x)}{Z} = \frac{8}{79\sqrt{\pi}}(3x^3 + 2x^2 - 4x)^2e^{-x^2}.\]</p><img src="d71a9bfa.svg" alt="Example block output"/><p>Now we need a bound with respect to the density of an easy distribution to sample. We may take <span>$X&#39;$</span> to be the standard normal distribution, for which the density is</p><p class="math-container">\[    q(x) = \frac{1}{\sqrt{2\pi}} e^{-\frac{1}{2}x^2},\]</p><p>and then we need to find <span>$M$</span> such that <span>$f(x) \leq M q(x),$</span> i.e.</p><p class="math-container">\[    (9x^6 + 12x^5 - 20x^4 - 16x^3 + 16x^2) e^{-x^2} \leq \frac{M}{\sqrt{2\pi}} e^{-\frac{1}{2}x^2}.\]</p><p>For that, we first need to compute the maximum values of the terms of the form <span>$x^n e^{-x^2/2}.$</span> Since the critical points of such a function occur at <span>$x = \pm \sqrt{n},$</span> we have</p><p class="math-container">\[    x^n e^{-x^2} \leq n^{n/2} e^{-n/2}e^{-x^2/2},\]</p><p>for any <span>$n\in\mathbb{N}.$</span> With that, and discarding the negative term with even power, we bound</p><p class="math-container">\[    \begin{align*}
        f(x) &amp; = (9x^6 + 12x^5 - 20x^4 - 16x^3 + 16x^2)e^{-x^2} \\
        &amp; \leq \sqrt{2\pi}(9 \times 6^3 e^{-3} + 12 \times 5^{5/2} e^{-5/2} + 16 \times 3^{3/2} e^{-3/2} + 16 \times 2 e^{-1})\frac{1}{\sqrt{2\pi}} e^{-x^2/2}.
    \end{align*}\]</p><p>for all <span>$x\in\mathbb{R}.$</span> Rounding up the coefficient to an integer, we find that</p><p class="math-container">\[    f(x) \leq 457 q(x),\]</p><p>so we take</p><p class="math-container">\[    M = 457.\]</p><p>This bound can be visualized as follows</p><img src="a18b0b92.svg" alt="Example block output"/><p>Well, one can see it is a loose bound, which will amount to too many rejections. We should find a tighter bound. Let us look for a bound with respect to the density of a normal distribution with variance <span>$2$</span> instead of the standard normal. For that, we split the exponential as</p><p class="math-container">\[    e^{-x^2} = e^{-\frac{3}{4}x^2} e^{-\frac{1}{4}x^2},\]</p><p>so the second exponential goes to the PDF <span>$e^{-x^2/4}/\sqrt{4\pi}$</span> of the distribution <span>$\mathcal{N}(0, 2),$</span> while the first exponential is used to bound the polynomial part,</p><p class="math-container">\[    \sqrt{4\pi}(9x^6 + 12x^5 - 20x^4 - 16x^3 + 16x^2)e^{-\frac{3}{4}x^2} \leq M.\]</p><p>Since the critical points of <span>$x^ne^{-3x^2/4}$</span> occur at <span>$x = \pm \sqrt{2n/3},$</span> we have</p><p class="math-container">\[    x^n e^{-\frac{3}{4}x^2} \leq \left(\frac{2n}{3}\right)^{n/2} e^{-n/2}.\]</p><p>Thus,</p><p class="math-container">\[    \begin{align*}
        &amp; \sqrt{4\pi}(9x^6 + 12x^5 - 20x^4 - 16x^3 + 16x^2)e^{-\frac{3}{4}x^2} \\
        &amp; \qquad \leq \sqrt{4\pi}(9\times 4^2 e^{-2} + 12 \times \left(\frac{10}{3}\right)^{5/2} e^{-5/2} + 16 \times 2^{3/2} e^{-3/2} + 16\left(\frac{4}{3}\right) * e^{-1}),
    \end{align*}\]</p><p>so we can take</p><p class="math-container">\[M = 204\]</p><p>We can see this bound is a bit tighter than the previous one, but it is still not tight enough as we can see by the high rate of rejection of more than 90% (the estimated value is <span>$Z/M \approx 0.0858$</span>).</p><img src="774b6310.svg" alt="Example block output"/><img src="14b38699.svg" alt="Example block output"/><img src="8c461b05.svg" alt="Example block output"/><img src="ee1bf454.svg" alt="Example block output"/><p>We can certainly improve acceptance rate by looking for a tighter bound. A numerical investigation reveals that we can apparently take <span>$M$</span> as low as <span>$88.$</span></p><p class="math-container">\[    \max_{-6 \leq x \leq 6} \left(\frac{f(x)}{q(x)}\right) \approx 87.5.\]</p><p>Using this bound, the expected acceptance rate is <span>$Z \approx 17.50 / 88 \approx 0.1989,$</span> so we more than double the acceptance rate, and we have a better approximation of the distribution.</p><img src="05c064e3.svg" alt="Example block output"/><img src="ede7f47a.svg" alt="Example block output"/><img src="434aa96f.svg" alt="Example block output"/><img src="e989f86f.svg" alt="Example block output"/><p>We can improve the sampling process much more by working with a normal distribution centered on the mean value obtained from <span>$f,$</span> which seems to be near <span>$x = 1.68.$</span></p><img src="9adaf7df.svg" alt="Example block output"/><pre><code class="language-julia hljs">vline!([mu], label=&quot;mean&quot;)</code></pre><img src="f2d1685d.svg" alt="Example block output"/><img src="001aeaca.svg" alt="Example block output"/><img src="616f4355.svg" alt="Example block output"/><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ol><li><a href="https://doi.org/10.1201/9781482296426">Dani Gamerman, Hedibert F. Lopes, &quot;Markov Chain Monte Carlo Stochastic Simulation for Bayesian Inference,&quot; Second Edition, Chapman and Hall/CRC, New York, 2006</a></li><li><a href="https://doi.org/10.1007/978-0-387-76371-2">Jun S. Liu, &quot;Monte Carlo Strategies in Scientific Computing,&quot; Springer Series in Statistics, Springer-Verlag New York 2004</a></li><li>John von Neumann, &quot;Various techniques used in connection with random digits. Monte Carlo methods&quot; <em>Nat. Bureau Standards,</em> 12 (1951), 36–38.</li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../box_muller/">« Box-Muller transform</a><a class="docs-footer-nextpage" href="../empiricalsup_rejection/">Empirical supremum rejection sampling »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Thursday 26 June 2025 15:36">Thursday 26 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
